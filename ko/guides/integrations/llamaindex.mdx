# LlamaIndex

WeaveëŠ” [LlamaIndex Python library](https://github.com/run-llama/llama_index)ë¥¼ í†µí•´ ì´ë£¨ì–´ì§„ ëª¨ë“  í˜¸ì¶œì˜ ì¶”ì  ë° ë¡œê¹…ì„ ë‹¨ìˆœí™”í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

LLMìœ¼ë¡œ ì‘ì—…í•  ë•Œ ë””ë²„ê¹…ì€ ë¶ˆê°€í”¼í•©ë‹ˆë‹¤. ëª¨ë¸ í˜¸ì¶œì´ ì‹¤íŒ¨í•˜ê±°ë‚˜, ì¶œë ¥ í˜•ì‹ì´ ì˜ëª»ë˜ê±°ë‚˜, ì¤‘ì²©ëœ ëª¨ë¸ í˜¸ì¶œì´ í˜¼ë€ì„ ì•¼ê¸°í•˜ëŠ” ê²½ìš° ë¬¸ì œë¥¼ ì •í™•íˆ ì°¾ì•„ë‚´ëŠ” ê²ƒì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. [LlamaIndex](https://docs.llamaindex.ai/en/stable/) ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì¢…ì¢… ì—¬ëŸ¬ ë‹¨ê³„ì™€ LLM í˜¸ì¶œ í˜¸ì¶œë¡œ êµ¬ì„±ë˜ì–´ ìˆì–´ ì²´ì¸ê³¼ ì—ì´ì „íŠ¸ì˜ ë‚´ë¶€ ì‘ë™ ë°©ì‹ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

WeaveëŠ” LlamaIndex ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì¶”ì ì„ ìë™ìœ¼ë¡œ ìº¡ì²˜í•˜ì—¬ ì´ í”„ë¡œì„¸ìŠ¤ë¥¼ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ë¶„ì„í•  ìˆ˜ ìˆì–´ LLM ì›Œí¬í”Œë¡œìš°ë¥¼ ë””ë²„ê¹…í•˜ê³  ìµœì í™”í•˜ê¸°ê°€ ë” ì‰¬ì›Œì§‘ë‹ˆë‹¤. WeaveëŠ” ë˜í•œ í‰ê°€ ì›Œí¬í”Œë¡œìš°ì—ë„ ë„ì›€ì´ ë©ë‹ˆë‹¤.

## ì‹œì‘í•˜ê¸°

ì‹œì‘í•˜ë ¤ë©´ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘ ë¶€ë¶„ì—ì„œ ê°„ë‹¨íˆ `weave.init()`ë¥¼ í˜¸ì¶œí•˜ì„¸ìš”. `weave.init()`ì˜ ì¸ìˆ˜ëŠ” ì¶”ì ì„ êµ¬ì„±í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” í”„ë¡œì íŠ¸ ì´ë¦„ì…ë‹ˆë‹¤.

```python
import weave
from llama_index.core.chat_engine import SimpleChatEngine

# Initialize Weave with your project name
# highlight-next-line
weave.init("llamaindex_demo")

chat_engine = SimpleChatEngine.from_defaults()
response = chat_engine.chat(
    "Say something profound and romantic about fourth of July"
)
print(response)
```

ìœ„ì˜ ì˜ˆì—ì„œëŠ” ë‚´ë¶€ì ìœ¼ë¡œ OpenAI í˜¸ì¶œì„ ìˆ˜í–‰í•˜ëŠ” ê°„ë‹¨í•œ LlamaIndex ì±„íŒ… ì—”ì§„ì„ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì¶”ì ì„ í™•ì¸í•˜ì„¸ìš”:

[![simple\_llamaindex.png](imgs/simple_llamaindex.png)](https://wandb.ai/wandbot/test-llamaindex-weave/weave/calls/b6b5d898-2df8-4e14-b553-66ce84661e74)

## ì¶”ì 

LlamaIndexëŠ” ë°ì´í„°ë¥¼ LLMê³¼ ì‰½ê²Œ ì—°ê²°í•  ìˆ˜ ìˆëŠ” ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤. ê°„ë‹¨í•œ RAG ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” ì„ë² ë”© ë‹¨ê³„, ê²€ìƒ‰ ë‹¨ê³„ ë° ì‘ë‹µ í•©ì„± ë‹¨ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë³µì¡ì„±ì´ ì¦ê°€í•¨ì— ë”°ë¼ ê°œë°œ ë° í”„ë¡œë•ì…˜ ì¤‘ì— ê°œë³„ ë‹¨ê³„ì˜ ì¶”ì ì„ ì¤‘ì•™ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•´ì§‘ë‹ˆë‹¤.

ì´ëŸ¬í•œ ì¶”ì ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë””ë²„ê¹…í•˜ê³  ê°œì„ í•˜ëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤. WeaveëŠ” í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿, LLM í˜¸ì¶œ, ë„êµ¬ ë° ì—ì´ì „íŠ¸ ë‹¨ê³„ë¥¼ í¬í•¨í•˜ì—¬ LlamaIndex ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ì´ë£¨ì–´ì§„ ëª¨ë“  í˜¸ì¶œì„ ìë™ìœ¼ë¡œ ì¶”ì í•©ë‹ˆë‹¤. Weave ì›¹ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì¶”ì ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒì€ LlamaIndexì˜ [Starter Tutorial (OpenAI)](https://docs.llamaindex.ai/en/stable/getting_started/starter_example/)ì—ì„œ ê°€ì ¸ì˜¨ ê°„ë‹¨í•œ RAG íŒŒì´í”„ë¼ì¸ì˜ ì˜ˆì…ë‹ˆë‹¤:

```python
import weave
from llama_index.core import VectorStoreIndex, SimpleDirectoryReader

# Initialize Weave with your project name
# highlight-next-line
weave.init("llamaindex_demo")

# Assuming you have a `.txt` file in the `data` directory
documents = SimpleDirectoryReader("data").load_data()
index = VectorStoreIndex.from_documents(documents)

query_engine = index.as_query_engine()
response = query_engine.query("What did the author do growing up?")
print(response)
```

ì¶”ì  íƒ€ì„ë¼ì¸ì€ "ì´ë²¤íŠ¸"ë¿ë§Œ ì•„ë‹ˆë¼ ì‹¤í–‰ ì‹œê°„, ë¹„ìš© ë° í•´ë‹¹ë˜ëŠ” ê²½ìš° í† í° ìˆ˜ë„ ìº¡ì²˜í•©ë‹ˆë‹¤. ê° ë‹¨ê³„ì˜ ì…ë ¥ê³¼ ì¶œë ¥ì„ ë³´ë ¤ë©´ ì¶”ì ì„ ìì„¸íˆ ì‚´í´ë³´ì„¸ìš”.

[![llamaindex\_rag.png](imgs/llamaindex_rag.png)](https://wandb.ai/wandbot/test-llamaindex-weave/weave/calls?filter=%7B%22traceRootsOnly%22%3Atrue%7D\&peekPath=%2Fwandbot%2Ftest-llamaindex-weave%2Fcalls%2F6ac53407-1bb7-4c38-b5a3-c302bd877a11%3Ftracetree%3D1)

## ì›í´ë¦­ ê´€ì°° ê°€ëŠ¥ì„± ğŸ”­

LlamaIndexëŠ” [one-click observability ğŸ”­](https://docs.llamaindex.ai/en/stable/module_guides/observability/)ë¥¼ ì œê³µí•˜ì—¬ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì›ì¹™ì ì¸ LLM ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

ìš°ë¦¬ì˜ í†µí•©ì€ LlamaIndexì˜ ì´ ê¸°ëŠ¥ì„ í™œìš©í•˜ê³  ìë™ìœ¼ë¡œ [`WeaveCallbackHandler()`](https://github.com/wandb/weave/blob/master/weave/integrations/llamaindex/llamaindex.py)ë¥¼ `llama_index.core.global_handler`ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. ë”°ë¼ì„œ LlamaIndexì™€ Weave ì‚¬ìš©ìë¡œì„œ í•„ìš”í•œ ê²ƒì€ Weave ì‹¤í–‰ì„ ì´ˆê¸°í™”í•˜ëŠ” ê²ƒë¿ì…ë‹ˆë‹¤ - `weave.init(<name-of-project>)`

## ë” ì‰¬ìš´ ì‹¤í—˜ì„ ìœ„í•œ `Model` ë§Œë“¤ê¸°

í”„ë¡¬í”„íŠ¸, ëª¨ë¸ êµ¬ì„± ë° ì¶”ë¡  ë§¤ê°œë³€ìˆ˜ì™€ ê°™ì€ ì—¬ëŸ¬ êµ¬ì„± ìš”ì†Œê°€ ìˆëŠ” ë‹¤ì–‘í•œ ì‚¬ìš© ì‚¬ë¡€ì— ëŒ€í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ LLMì„ êµ¬ì„±í•˜ê³  í‰ê°€í•˜ëŠ” ê²ƒì€ ì–´ë µìŠµë‹ˆë‹¤. [`weave.Model`](/ko/guides/core-types/models)ë¥¼ ì‚¬ìš©í•˜ë©´ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë‚˜ ì‚¬ìš©í•˜ëŠ” ëª¨ë¸ê³¼ ê°™ì€ ì‹¤í—˜ ì„¸ë¶€ ì •ë³´ë¥¼ ìº¡ì²˜í•˜ê³  êµ¬ì„±í•˜ì—¬ ë‹¤ì–‘í•œ ë°˜ë³µì„ ë” ì‰½ê²Œ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ ì˜ˆì œëŠ” `WeaveModel`ì—ì„œ LlamaIndex ì¿¼ë¦¬ ì—”ì§„ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì£¼ë©°, [weave/data](https://github.com/wandb/weave/tree/master/data) folder:

```python
import weave

from llama_index.core import VectorStoreIndex, SimpleDirectoryReader
from llama_index.core.node_parser import SentenceSplitter
from llama_index.llms.openai import OpenAI
from llama_index.core import PromptTemplate


PROMPT_TEMPLATE = """
You are given with relevant information about Paul Graham. Answer the user query only based on the information provided. Don't make up stuff.

User Query: {query_str}
Context: {context_str}
Answer:
"""

# highlight-next-line
class SimpleRAGPipeline(weave.Model):
    chat_llm: str = "gpt-4"
    temperature: float = 0.1
    similarity_top_k: int = 2
    chunk_size: int = 256
    chunk_overlap: int = 20
    prompt_template: str = PROMPT_TEMPLATE

    def get_llm(self):
        return OpenAI(temperature=self.temperature, model=self.chat_llm)

    def get_template(self):
        return PromptTemplate(self.prompt_template)

    def load_documents_and_chunk(self, data):
        documents = SimpleDirectoryReader(data).load_data()
        splitter = SentenceSplitter(
            chunk_size=self.chunk_size,
            chunk_overlap=self.chunk_overlap,
        )
        nodes = splitter.get_nodes_from_documents(documents)
        return nodes

    def get_query_engine(self, data):
        nodes = self.load_documents_and_chunk(data)
        index = VectorStoreIndex(nodes)

        llm = self.get_llm()
        prompt_template = self.get_template()

        return index.as_query_engine(
            similarity_top_k=self.similarity_top_k,
            llm=llm,
            text_qa_template=prompt_template,
        )

# highlight-next-line
    @weave.op()
    def predict(self, query: str):
        query_engine = self.get_query_engine(
            # This data can be found in the weave repo under data/paul_graham
            "data/paul_graham",
        )
        response = query_engine.query(query)
        return {"response": response.response}

# highlight-next-line
weave.init("test-llamaindex-weave")

rag_pipeline = SimpleRAGPipeline()
response = rag_pipeline.predict("What did the author do growing up?")
print(response)
```

ì—ì„œ ì°¾ì„ ìˆ˜ ìˆëŠ” ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.`SimpleRAGPipeline`ì—ì„œ ìƒì†ëœ ì´ `weave.Model` í´ë˜ìŠ¤ëŠ” ì´ RAG íŒŒì´í”„ë¼ì¸ì— ëŒ€í•œ ì¤‘ìš”í•œ ë§¤ê°œë³€ìˆ˜ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤. `query` ë©”ì„œë“œë¥¼ `weave.op()` ì¶”ì ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

[![llamaindex\_model.png](imgs/llamaindex_model.png)](https://wandb.ai/wandbot/test-llamaindex-weave/weave/calls?filter=%7B%22traceRootsOnly%22%3Atrue%7D\&peekPath=%2Fwandbot%2Ftest-llamaindex-weave%2Fcalls%2Fa82afbf4-29a5-43cd-8c51-603350abeafd%3Ftracetree%3D1)

## Evaluationìœ¼ë¡œ í‰ê°€í•˜ê¸° `weave.Evaluation`

EvaluationsëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì„ ì¸¡ì •í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤. [`weave.Evaluation`](/ko/guides/core-types/evaluations) í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë¸ì´ íŠ¹ì • ì‘ì—…ì´ë‚˜ ë°ì´í„°ì…‹ì—ì„œ ì–¼ë§ˆë‚˜ ì˜ ìˆ˜í–‰í•˜ëŠ”ì§€ ìº¡ì²˜í•  ìˆ˜ ìˆì–´, ë‹¤ì–‘í•œ ëª¨ë¸ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë°˜ë³µ ë²„ì „ì„ ë¹„êµí•˜ê¸° ì‰½ê²Œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. ë‹¤ìŒ ì˜ˆì œëŠ” ìš°ë¦¬ê°€ ìƒì„±í•œ ëª¨ë¸ì„ í‰ê°€í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:

```python
import asyncio
from llama_index.core.evaluation import CorrectnessEvaluator

eval_examples = [
    {
        "id": "0",
        "query": "What programming language did Paul Graham learn to teach himself AI when he was in college?",
        "ground_truth": "Paul Graham learned Lisp to teach himself AI when he was in college.",
    },
    {
        "id": "1",
        "query": "What was the name of the startup Paul Graham co-founded that was eventually acquired by Yahoo?",
        "ground_truth": "The startup Paul Graham co-founded that was eventually acquired by Yahoo was called Viaweb.",
    },
    {
        "id": "2",
        "query": "What is the capital city of France?",
        "ground_truth": "I cannot answer this question because no information was provided in the text.",
    },
]

llm_judge = OpenAI(model="gpt-4", temperature=0.0)
evaluator = CorrectnessEvaluator(llm=llm_judge)

# highlight-next-line
@weave.op()
def correctness_evaluator(query: str, ground_truth: str, output: dict):
    result = evaluator.evaluate(
        query=query, reference=ground_truth, response=output["response"]
    )
    return {"correctness": float(result.score)}

# highlight-next-line
evaluation = weave.Evaluation(dataset=eval_examples, scorers=[correctness_evaluator])

rag_pipeline = SimpleRAGPipeline()

# highlight-next-line
asyncio.run(evaluation.evaluate(rag_pipeline))
```

ì´ í‰ê°€ëŠ” ì• ì„¹ì…˜ì˜ ì˜ˆì œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤. `weave.Evaluation`ì„ ì‚¬ìš©í•œ í‰ê°€ëŠ” í‰ê°€ ë°ì´í„°ì…‹, ì ìˆ˜ ë§¤ê¸°ê¸° í•¨ìˆ˜ ë° `weave.Model`ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì„¸ ê°€ì§€ í•µì‹¬ êµ¬ì„± ìš”ì†Œì— ëŒ€í•œ ëª‡ ê°€ì§€ ë¯¸ë¬˜í•œ ì°¨ì´ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* í‰ê°€ ìƒ˜í”Œ ë”•ì…”ë„ˆë¦¬ì˜ í‚¤ê°€ ì ìˆ˜ ë§¤ê¸°ê¸° í•¨ìˆ˜ì˜ ì¸ìˆ˜ ë° `weave.Model`ì˜ `predict` ë©”ì„œë“œì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
* `weave.Model`ì—ëŠ” `predict` ë˜ëŠ” `infer` ë˜ëŠ” `forward` ì´ë¦„ì˜ ë©”ì„œë“œê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ ë©”ì„œë“œë¥¼ `weave.op()`ë¡œ ì¥ì‹í•˜ì—¬ ì¶”ì í•©ë‹ˆë‹¤.
* ì ìˆ˜ ë§¤ê¸°ê¸° í•¨ìˆ˜ëŠ” `weave.op()`ë¡œ ì¥ì‹ë˜ì–´ì•¼ í•˜ë©° `output`ë¥¼ ëª…ëª…ëœ ì¸ìˆ˜ë¡œ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.

[![llamaindex\_evaluation.png](imgs/llamaindex_evaluation.png)](https://wandb.ai/wandbot/llamaindex-weave/weave/calls?filter=%7B%22opVersionRefs%22%3A%5B%22weave%3A%2F%2F%2Fwandbot%2Fllamaindex-weave%2Fop%2FEvaluation.predict_and_score%3ANmwfShfFmgAhDGLXrF6Xn02T9MIAsCXBUcifCjyKpOM%22%5D%2C%22parentId%22%3A%2233491e66-b580-47fa-9d43-0cd6f1dc572a%22%7D\&peekPath=%2Fwandbot%2Fllamaindex-weave%2Fcalls%2F33491e66-b580-47fa-9d43-0cd6f1dc572a%3Ftracetree%3D1)

Weaveë¥¼ LlamaIndexì™€ í†µí•©í•¨ìœ¼ë¡œì¨ LLM ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í¬ê´„ì ì¸ ë¡œê¹…ê³¼ ëª¨ë‹ˆí„°ë§ì„ ë³´ì¥í•˜ì—¬ í‰ê°€ë¥¼ í†µí•œ ë””ë²„ê¹…ê³¼ ì„±ëŠ¥ ìµœì í™”ë¥¼ ë” ì‰½ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
