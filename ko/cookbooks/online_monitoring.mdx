---
- title: ì˜¨ë¼ì¸ ëª¨ë‹ˆí„°ë§
- description: W&B Weaveë¡œ ì˜¨ë¼ì¸ ëª¨ë‹ˆí„°ë§ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²• ì•Œì•„ë³´ê¸°
---

<Note>
  ì´ê²ƒì€ ëŒ€í™”í˜• ë…¸íŠ¸ë¶ì…ë‹ˆë‹¤. ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ê±°ë‚˜ ì•„ë˜ ë§í¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

  * [Open in Google Colab](https://colab.research.google.com/github/wandb/weave/blob/master/docs/notebooks/online_monitoring.ipynb)
  * [View source on GitHub](https://github.com/wandb/weave/blob/master/docs/notebooks/online_monitoring.ipynb)
</Note>

# Weaveì™€ í†µí•©: í”„ë¡œë•ì…˜ ëŒ€ì‹œë³´ë“œ

GenAI ë„êµ¬ í™˜ê²½ì€ ë¹ ë¥´ê²Œ ì§„í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤ - ìƒˆë¡œìš´ í”„ë ˆì„ì›Œí¬, ë„êµ¬ ë° ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê³„ì†í•´ì„œ ë“±ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. WeaveëŠ” ëª¨ë“  GenAI ëª¨ë‹ˆí„°ë§ ë° í‰ê°€ ìš”êµ¬ ì‚¬í•­ì„ ìœ„í•œ ì›ìŠ¤í†± ì†”ë£¨ì…˜ì´ ë˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤. ì´ëŠ” ë•Œë¡œëŠ” ê¸°ì¡´ í”Œë«í¼ê³¼ í†µí•©í•˜ê±°ë‚˜ í”„ë¡œì íŠ¸ ë˜ëŠ” ì¡°ì§ì˜ íŠ¹ì • ìš”êµ¬ ì‚¬í•­ì— ë§ê²Œ Weaveë¥¼ í™•ì¥í•´ì•¼ í•  í•„ìš”ê°€ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ì´ ì¿¡ë¶ì—ì„œëŠ” Weaveì˜ ê°•ë ¥í•œ APIì™€ í•¨ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ Weaveì˜ Traces ë·°ë¥¼ í™•ì¥í•˜ëŠ” í”„ë¡œë•ì…˜ ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“œëŠ” ë°©ë²•ì„ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ë‹¤ìŒ ì‚¬í•­ì— ì¤‘ì ì„ ë‘˜ ê²ƒì…ë‹ˆë‹¤:

* Weaveì—ì„œ íŠ¸ë ˆì´ìŠ¤, ë¹„ìš©, í”¼ë“œë°± ë° ê¸°íƒ€ ë©”íŠ¸ë¦­ ê°€ì ¸ì˜¤ê¸°
* ì‚¬ìš©ì í”¼ë“œë°± ë° ë¹„ìš© ë¶„í¬ì— ëŒ€í•œ ì§‘ê³„ ë·° ìƒì„±
* ì‹œê°„ì— ë”°ë¥¸ í† í° ì‚¬ìš©ëŸ‰ ë° ì§€ì—° ì‹œê°„ì— ëŒ€í•œ ì‹œê°í™” ìƒì„±

streamlitì„ ì„¤ì¹˜í•˜ê³  ë‹¤ìŒì„ ì‹¤í–‰í•˜ì—¬ ìì‹ ì˜ Weave í”„ë¡œì íŠ¸ë¡œ ëŒ€ì‹œë³´ë“œë¥¼ ì‹œë„í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ [ì´ í”„ë¡œë•ì…˜ ëŒ€ì‹œë³´ë“œ ìŠ¤í¬ë¦½íŠ¸](https://github.com/NiWaRe/agent-dev-collection)!

<img src="https://github.com/NiWaRe/knowledge-worker-weave/blob/master/screenshots/dashboard_weave_preview.jpg?raw=true" width="1000" alt="Example Production Dashboard with Weave" />

# 1. ì„¤ì •

ì´ íŠœí† ë¦¬ì–¼ì„ ë”°ë¼í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒ íŒ¨í‚¤ì§€ë§Œ ì„¤ì¹˜í•˜ë©´ ë©ë‹ˆë‹¤:

```python
!pip install streamlit pandas plotly weave
```

# 2. êµ¬í˜„

## 2.1 Weave í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ë° ë¹„ìš© ì •ì˜

ë¨¼ì €, Weave í´ë¼ì´ì–¸íŠ¸ë¥¼ ì´ˆê¸°í™”í•˜ê³  ê° ëª¨ë¸ì— ëŒ€í•œ ë¹„ìš©ì„ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.

* ë§ì€ í‘œì¤€ ëª¨ë¸ì— ëŒ€í•œ í‘œì¤€ ë¹„ìš©ì„ í¬í•¨í–ˆì§€ë§Œ ìì²´ ì»¤ìŠ¤í…€ ë¹„ìš©ê³¼ ì»¤ìŠ¤í…€ ëª¨ë¸ì„ ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒì—ì„œëŠ” ëª‡ ê°€ì§€ ëª¨ë¸ì— ëŒ€í•œ ì»¤ìŠ¤í…€ ë¹„ìš©ì„ ì¶”ê°€í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” í‘œì¤€ ë¹„ìš©ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
* ë¹„ìš©ì€ Weaveì—ì„œ ê° í˜¸ì¶œì— ëŒ€í•´ ì¶”ì ëœ í† í°ì„ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤. ë§ì€ LLM ë²¤ë” ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê²½ìš°, í† í° ì‚¬ìš©ëŸ‰ì„ ìë™ìœ¼ë¡œ ì¶”ì í•˜ì§€ë§Œ ëª¨ë“  í˜¸ì¶œì— ëŒ€í•´ ì»¤ìŠ¤í…€ í† í° ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì»¤ìŠ¤í…€ ëª¨ë¸ì— ëŒ€í•œ í† í° ìˆ˜ ë° ë¹„ìš© ê³„ì‚°ì„ ì •ì˜í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì´ ì¿¡ë¶ì„ ì°¸ì¡°í•˜ì„¸ìš” - [ì»¤ìŠ¤í…€ ë¹„ìš© ì¿¡ë¶](https://weave-docs.wandb.ai/cookbooks/custom_model_cost#setting-up-a-model-with-weave).

```python
PROJECT_NAME = "wandb-smle/weave-cookboook-demo"
python
import weave

MODEL_NAMES = [
    # model name, prompt cost, completion cost
    ("gpt-4o-2024-05-13", 0.03, 0.06),
    ("gpt-4o-mini-2024-07-18", 0.03, 0.06),
    ("gemini/gemini-1.5-flash", 0.00025, 0.0005),
    ("gpt-4o-mini", 0.03, 0.06),
    ("gpt-4-turbo", 0.03, 0.06),
    ("claude-3-haiku-20240307", 0.01, 0.03),
    ("gpt-4o", 0.03, 0.06),
]

def init_weave_client(project_name):
    try:
        client = weave.init(project_name)
        for model, prompt_cost, completion_cost in MODEL_NAMES:
            client.add_cost(
                llm_id=model,
                prompt_token_cost=prompt_cost,
                completion_token_cost=completion_cost,
            )
    except Exception as e:
        print(f"Failed to initialize Weave client for project '{project_name}': {e}")
        return None
    else:
        return client

client = init_weave_client(PROJECT_NAME)
```

## 2.2 Weaveì—ì„œ í˜¸ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

Weaveì—ì„œ í˜¸ì¶œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ë‘ ê°€ì§€ ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤:

1. í˜¸ì¶œë³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
2. ê³ ìˆ˜ì¤€ API ì‚¬ìš©í•˜ê¸°

### 2.2.1 í˜¸ì¶œë³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

Weaveì—ì„œ ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ì²« ë²ˆì§¸ ì˜µì…˜ì€ í•„í„°ë§ëœ í˜¸ì¶œ ëª©ë¡ì„ ê²€ìƒ‰í•˜ê³  í˜¸ì¶œë³„ë¡œ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ `calls_query_stream` APIë¥¼ ì‚¬ìš©í•˜ì—¬ Weaveì—ì„œ í˜¸ì¶œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* `calls_query_stream` API: This API allows us to fetch the calls data from Weave.
* `filter` dictionary: This dictionary contains the filter parameters to fetch the calls data - see [ì—¬ê¸°](https://weave-docs.wandb.ai/reference/python-sdk/weave/trace_server/weave.trace_server.trace_server_interface/#class-callschema)ì—ì„œ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.
* `expand_columns` list: This list contains the columns to expand in the calls data.
* `sort_by` list: This list contains the sorting parameters for the calls data.
* `include_costs` boolean: This boolean indicates whether to include the costs in the calls data.
* `include_feedback` boolean: This boolean indicates whether to include the feedback in the calls data.

```python
import itertools
from datetime import datetime, timedelta

import pandas as pd

def fetch_calls(client, project_id, start_time, trace_roots_only, limit):
    filter_params = {
        "project_id": project_id,
        "filter": {"started_at": start_time, "trace_roots_only": trace_roots_only},
        "expand_columns": ["inputs.example", "inputs.model"],
        "sort_by": [{"field": "started_at", "direction": "desc"}],
        "include_costs": True,
        "include_feedback": True,
    }
    try:
        calls_stream = client.server.calls_query_stream(filter_params)
        calls = list(
            itertools.islice(calls_stream, limit)
        )  # limit the number of calls to fetch if too many
        print(f"Fetched {len(calls)} calls.")
    except Exception as e:
        print(f"Error fetching calls: {e}")
        return []
    else:
        return calls

calls = fetch_calls(client, PROJECT_NAME, datetime.now() - timedelta(days=1), True, 100)
python
# the raw data is a list of Call objects
pd.DataFrame([call.dict() for call in calls]).head(3)
```

Weaveì˜ ë°˜í™˜ê°’ìœ¼ë¡œ í˜¸ì¶œì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì€ ë§¤ìš° ì‰½ìŠµë‹ˆë‹¤ - ê´€ë ¨ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ ë”•ì…”ë„ˆë¦¬ ëª©ë¡ì— ì €ì¥í•  ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ë”•ì…”ë„ˆë¦¬ ëª©ë¡ì„ pandas DataFrameìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.

```python
import json
from datetime import datetime

import pandas as pd

def process_calls(calls):
    records = []
    for call in calls:
        feedback = call.summary.get("weave", {}).get("feedback", [])
        thumbs_up = sum(
            1
            for item in feedback
            if isinstance(item, dict) and item.get("payload", {}).get("emoji") == "ğŸ‘"
        )
        thumbs_down = sum(
            1
            for item in feedback
            if isinstance(item, dict) and item.get("payload", {}).get("emoji") == "ğŸ‘"
        )
        latency = call.summary.get("weave", {}).get("latency_ms", 0)

        records.append(
            {
                "Call ID": call.id,
                "Trace ID": call.trace_id,  # this is a unique ID for the trace that can be used to retrieve it
                "Display Name": call.display_name,  # this is an optional name you can set in the UI or programatically
                "Latency (ms)": latency,
                "Thumbs Up": thumbs_up,
                "Thumbs Down": thumbs_down,
                "Started At": pd.to_datetime(getattr(call, "started_at", datetime.min)),
                "Inputs": json.dumps(call.inputs, default=str),
                "Outputs": json.dumps(call.output, default=str),
            }
        )
    return pd.DataFrame(records)
python
df_calls = process_calls(calls)
df_calls.head(3)
```

### 2.2.2 ê³ ìˆ˜ì¤€ API ì‚¬ìš©í•˜ê¸°

ëª¨ë“  í˜¸ì¶œì„ ì¼ì¼ì´ ì‚´í´ë³´ëŠ” ëŒ€ì‹  WeaveëŠ” ëª¨ë¸ ë¹„ìš©, í”¼ë“œë°± ë° ê¸°íƒ€ ë©”íŠ¸ë¦­ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê³ ìˆ˜ì¤€ APIë¥¼ ì œê³µí•©ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, ë¹„ìš©ì˜ ê²½ìš° `query_costs` APIë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ëœ ëª¨ë“  LLMì˜ ë¹„ìš©ì„ ê°€ì ¸ì˜µë‹ˆë‹¤:

```python
# Use cost API to get costs
costs = client.query_costs()
df_costs = pd.DataFrame([cost.dict() for cost in costs])
df_costs["total_cost"] = (
    df_costs["prompt_token_cost"] + df_costs["completion_token_cost"]
)

# only show the first row for every unqiue llm_id
df_costs
```

## 2.4 ì…ë ¥ ìˆ˜ì§‘ ë° ì‹œê°í™” ìƒì„±

ë‹¤ìŒìœ¼ë¡œ, plotlyë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œê°í™”ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ ê°€ì¥ ê¸°ë³¸ì ì¸ ëŒ€ì‹œë³´ë“œì´ì§€ë§Œ ì›í•˜ëŠ” ëŒ€ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ë” ë³µì¡í•œ ì˜ˆì œëŠ” Streamlit ì˜ˆì œë¥¼ [ì—¬ê¸°](https://github.com/NiWaRe/knowledge-worker-weave/blob/master/prod_dashboard.py)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

```python
import plotly.express as px
import plotly.graph_objects as go

def plot_feedback_pie_chart(thumbs_up, thumbs_down):
    fig = go.Figure(
        data=[
            go.Pie(
                labels=["Thumbs Up", "Thumbs Down"],
                values=[thumbs_up, thumbs_down],
                marker={"colors": ["#66b3ff", "#ff9999"]},
                hole=0.3,
            )
        ]
    )
    fig.update_traces(textinfo="percent+label", hoverinfo="label+percent")
    fig.update_layout(showlegend=False, title="Feedback Summary")
    return fig

def plot_model_cost_distribution(df):
    fig = px.bar(
        df,
        x="llm_id",
        y="total_cost",
        color="llm_id",
        title="Cost Distribution by Model",
    )
    fig.update_layout(xaxis_title="Model", yaxis_title="Cost (USD)")
    return fig

# See the source code for all the plots
python
plot_feedback_pie_chart(df_calls["Thumbs Up"].sum(), df_calls["Thumbs Down"].sum())
python
plot_model_cost_distribution(df_costs)
```

# ê²°ë¡ 

ì´ ì¿¡ë¶ì—ì„œëŠ” Weaveì˜ APIì™€ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¤ìŠ¤í…€ í”„ë¡œë•ì…˜ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“œëŠ” ë°©ë²•ì„ ë³´ì—¬ë“œë ¸ìŠµë‹ˆë‹¤. WeaveëŠ” í˜„ì¬ ë°ì´í„°ì˜ ì‰¬ìš´ ì…ë ¥ê³¼ ì»¤ìŠ¤í…€ í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•œ ë°ì´í„° ì¶”ì¶œì„ ìœ„í•œ ë¹ ë¥¸ í†µí•©ì— ì¤‘ì ì„ ë‘ê³  ìˆìŠµë‹ˆë‹¤.

* **ë°ì´í„° ì…ë ¥:**
  * í”„ë ˆì„ì›Œí¬ì— êµ¬ì• ë°›ì§€ ì•ŠëŠ” íŠ¸ë ˆì´ì‹± [@weave-op()](https://weave-docs.wandb.ai/quickstart#2-log-a-trace-to-a-new-project) ë°ì½”ë ˆì´í„°ì™€ CSVì—ì„œ í˜¸ì¶œì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„± (ê´€ë ¨ [ê°€ì ¸ì˜¤ê¸° ì¿¡ë¶](https://weave-docs.wandb.ai/cookbooks/import_from_csv) ì°¸ì¡°)
  * ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° í”„ë ˆì„ì›Œí¬ ë° ì–¸ì–´ì—ì„œ Weaveì— ë¡œê¹…í•˜ê¸° ìœ„í•œ ì„œë¹„ìŠ¤ API ì—”ë“œí¬ì¸íŠ¸, [ì—¬ê¸°](https://weave-docs.wandb.ai/reference/service-api/call-start-call-start-post)ì—ì„œ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.
* **ë°ì´í„° ì¶œë ¥:**
  * CSV, TSV, JSONL, JSON í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì‰½ê²Œ ë‹¤ìš´ë¡œë“œ - [ì—¬ê¸°](https://weave-docs.wandb.ai/guides/tracking/tracing#querying--exporting-calls)ì—ì„œ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.
  * ë°ì´í„°ì— ëŒ€í•œ í”„ë¡œê·¸ë˜ë° ë°©ì‹ì˜ ì ‘ê·¼ì„ ì‚¬ìš©í•œ ì‰¬ìš´ ë‚´ë³´ë‚´ê¸° - ì´ ì¿¡ë¶ì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ ë‚´ë³´ë‚´ê¸° íŒ¨ë„ì˜ "Use Python" ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”. [ì—¬ê¸°](https://weave-docs.wandb.ai/guides/tracking/tracing#querying--exporting-calls)ì—ì„œ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.

ì´ ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œëŠ” Weaveì˜ ê¸°ë³¸ Traces ë·°ë¥¼ í™•ì¥í•˜ì—¬ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ LLM ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë§ì¶¤í˜• ëª¨ë‹ˆí„°ë§ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ë” ë³µì¡í•œ ëŒ€ì‹œë³´ë“œë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´, ìì‹ ì˜ Weave í”„ë¡œì íŠ¸ URLì„ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” Streamlit ì˜ˆì œë¥¼ [ì´ ì €ì¥ì†Œì—ì„œ](https://github.com/NiWaRe/agent-dev-collection) í™•ì¸í•˜ì„¸ìš”.
